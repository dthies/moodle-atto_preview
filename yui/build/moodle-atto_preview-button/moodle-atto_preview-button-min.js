YUI.add("moodle-atto_preview-button",function(e,t){var n="atto_preview",r="preview",i=!1;e.namespace("M.atto_preview").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){var t=this.addButton({icon:"e/preview",callback:this._toggle});t.set("title",M.util.get_string("pluginname",n)),e.after("windowresize",e.bind(this._fitToScreen,this)),this.editor.on(["gesturemove","gesturemoveend"],e.bind(this._fitToScreen,this),{standAlone:!0},this),this.toolbar.on("click",e.bind(this._fitToScreen,this))},_toggle:function(e){e.preventDefault();var t=this.buttons[r];t.getData(i)?(this.unHighlightButtons(r),this._setpreview(t)):(this.highlightButtons(r),this._setpreview(t,!0))},_fitToScreen:function(){var e=this.buttons[r];if(!e.getData(i))return;var t=this.get("host");this.preview.setStyles({position:"absolute",height:t.editor.getComputedStyle("height"),width:t.editor.getComputedStyle("width"),top:t.editor.getComputedStyle("top"),left:t.editor.getComputedStyle("left")}),this.preview.setY(this.editor.getY())},_setpreview:function(t,n){var r=this.get("host");if(n){this.preview=e.Node.create('<iframe src="'+this.get("previewurl")+"?sesskey="+this.get("sesskey")+"&contextid="+this.get("contextid")+"&content="+encodeURIComponent(r.textarea.get("value"))+'" srcdoc=""></iframe'),this.preview.setStyles({backgroundColor:e.one("body").getComputedStyle("backgroundColor"),backgroundImage:"url("+M.util.image_url("i/loading","core")+")",backgroundRepeat:"no-repeat",backgroundPosition:"center center"}),r._wrapper.appendChild(this.preview);var s={sesskey:this.get("sesskey"),contextid:this.get("contextid"),content:r.textarea.get("value")};e.io(this.get("previewurl"),{context:this,data:s,on:{complete:this._loadContent},method:"POST"}),r.disablePlugins(),r.enablePlugins(this.name),typeof e.M.atto_fullscreen!="undefined"&&r.enablePlugins("fullscreen")}else this.preview.remove(!0),r.enablePlugins();t.setData(i,!!n),this._fitToScreen()},_loadContent:function(e,t){var n=t.responseText;this.preview.setAttribute("srcdoc",n)}},{ATTRS:{previewurl:{value:null},contextid:{value:null},sesskey:{value:null}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
